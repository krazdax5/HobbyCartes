<!CAS D'UTILISTATION modifier_ses_informations modèle="dialogue-contrôle-entitée" diagramme="modifier_ses_informations.uxf|modifier_ses_informations.png" />

<@DIALOGUE>
	<PAGE_PARTIELLE membre.aspx(onglet: profil)>
		<txtPrenom type="textbox" />
		<txtNom type="textbox" />
		<txtNomUtilisateur type="textbox" />
		<txtMotPass type="textbox" />
	
		<txtRepMotPass type="textbox" >
			<validation comparaison="txtMotPass" échec="//redemander un mot de passe//" />
		</txtRepMotPass>
	
		<txtVille type="textbox"/>
	
		<txtCodePostal type="textbox">
			<validation comparaison="txtCodePostal" format="A9A9A9" échec="//redemander un code postal//" />
		</txtCodePostal>
	
		<txtCourriel type="textbox">
			<validation comparaison="txtCourriel" format="?@?.?" échec="//redemdander une adresse courriel//" />
		</txtCourriel>
	</PAGE_PARTIELLE>
<@/DIALOGUE>

<@CONTRÔLE>
	STRUCTURE infoM:
		STRING	prenom;
		STRING	nom;
		STRING	nomUtilisateur;
		STRING	motPasse;
		STRING	ville;
		STRING	codePostal;
		STRING	courriel;
		BOOL	admin 		<-- FALSE;
		STRING	arrierePlan <-- NULL;
	FIN STRUCTURE
	
	CODE membre.aspx.vb:
		ÉVÉNEMENT CLIQUE BOUTON btnConfirmer:
			infoM.prenom 			<-- txtPrenom;
			infoM.nom 				<-- txtNom;
			infoM.nomUtilisateur 	<-- txtNomUtilisateur;
			infoM.motPass 			<-- txtMotPass;
			infoM.ville 			<-- txtVille;
			infoM.codePostal 		<-- txtCodePostal;
			infoM.courriel 			<-- txtCourriel;
			
			BOOL ok;
			STRING erreur 	<-- "";
			ENTIER idMembre <-- ENTITÉ.membre.idMembreSession();
			
			ok 				<-- ENTITÉE.membre.verifierPseudo(infoM.nomUtilisateur);
			SI(NON ok):
				AFFICHER "Ce nom d'utilisateur est déjà utilisé!";
			AUTREMENT:
				ok 			<-- ENTITÉE.membre.modifierMembre(idMembre, infoM, RETOUR erreur);
				SI(NON ok):
					AFFICHER erreur;
				AUTREMENT:
					RECHARGER membre.aspx;
				FIN SI
			FIN SI
		FIN ÉVÉNEMENT
		
		ÉVÉNEMENT CHARGEMENT PAGE:
			ENTIER idMembre <-- ENTITÉ.membre.idMembreSession();
			
			infoM <-- ENTITÉ.membre.recupereInfos(idMembre);
			
			REMPLIR CONTRÔLES PAGE AVEC infoM;
		FIN ÉVÉNEMENT
	FIN CODE
<@/CONTRÔLE>

<@ENTITÉE_PARTIELLE>
	CONTRÔLE.STRUCTURE.infoM infoM;
	
	CODE membre.vb:
		MÉTHODE modifierMembre(ENTIER idMembre, STRUCTURE.infoM infos, RETOUR STRING messageErreur):
			ESSAIE:
				REQUÊTE_BD("UPDATE hobbyCartes.membre
								SET (prenom =" 				+ infos.prenom + "," +
									"nom = " 				+ infos.nom + "," +
									"nomutilisateur = " 	+ infos.nomUtilisateur + "," +
									"motpass = " 			+ infos.motpass + "," +
									"ville = " 				+ infos.ville + "," +
									"codepostal = " 		+ infos.codePostal + "," +
									"courriel = "			+ infos.courriel + "," +
									"admin = "				+ infos.admin + "," +
									"arreiereplan = "		+ infos.arrierePlan + ");"
							);
				RETOURNER VRAI;
			ÉCHEC(EXCEPTION ex):
				messageErreur <-- "La requête n'a pas aboutie!" + ex.message;
				RETOURNER FAUX;
			FIN ESSAIE
		FIN MÉTHODE
	FIN CODE
<@/ENTITÉE_PARTIELLE>